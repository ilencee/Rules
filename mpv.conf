# ======================= 硬件解码 =======================
hwdec=d3d11va                   # D3D11VA 硬解，减少 CPU 负载
hwdec-codecs=all                 # 尝试所有格式硬解，自动回退到软件解码

# ======================= 视频输出 =======================
vo=gpu-next                      # 新渲染管线，高质量抗锯齿 + HDR 支持
gpu-api=d3d11                    # Windows 最佳 GPU 接口
target-colorspace-hint=yes       # 自动匹配视频色彩空间
fullscreen=yes                    # 启动全屏

# ======================= GPU 高画质 =======================
profile=gpu-hq                   # 内置高画质预设（抗锯齿、锐化、HDR 优化）
gpu-shader-cache-dir="~~/shaders_cache"  # GPU shader 缓存，提升启动速度

# ======================= 滤镜强化（开满高画质） =======================
scale=ewa_lanczossharp           # 缩放用高质量 LanczosSharp
cscale=ewa_lanczossharp          # 色彩转换缩放
dscale=mitchell                   # 渲染到屏幕分辨率的高质量缩放
tscale=oversample                 # 高质量字幕缩放
interpolation=yes                 # 插帧（仅渲染平滑移动画面）

# ======================= 色彩管理 =======================
icc-profile-auto
icc-cache-dir="~~/icc_cache"
# 不指定 target-prim，依赖 ICC 和 profile=gpu-hq 自动匹配

# ======================= 音频 =======================
audio-file-auto=fuzzy             # 自动加载同名外置音轨
audio-channels=stereo             # 强制输出双声道（防止部分外置音轨异常）
audio-spdif=yes                   # SPDIF pass-through（可选）

# ======================= 缩放 / 字幕 =======================
scale=ewa_lanczossharp
cscale=ewa_lanczossharp
dscale=mitchell
tscale=oversample
interpolation=yes                # 插帧平滑运动画面

# ======================= 截图 =======================
screenshot-directory="~~desktop/"  # 截图输出到桌面
screenshot-format=png              # 无损截图
screenshot-high-bit-depth=yes      # 保留高色深

# ======================= 播放行为 =======================
keep-open=yes
save-position-on-quit=yes

# ======================= 日志/调试 =======================
#log-file="~~desktop/mpv.log"      # 调试用，可开启

# ======================= OSD =======================
osd-level=3                        # 显示详细播放信息
osd-fractions                       # 小数播放进度
# ======================== 缓存总开关 ==========================
cache=yes
# 开启流媒体缓存（HTTP/Emby 必须开）

# ========== 缓存存储方式 ==========
cache-on-disk=no
# 只使用内存缓存

# ========== 最大缓存容量 ==========
demuxer-max-bytes=1024MiB
# 允许缓存的最大数据量（不是强制占满）
# 1024MiB = 1GB
# 只是“上限”，不会一开始就吃满1GB
# 建议：
# 8GB内存 → 512MiB
# 16GB内存 → 1024MiB
# 32GB以上 → 2048MiB

# ========== 缓存时长 ==========
cache-secs=300
# 单位是“秒”，不是毫秒

# ========== 预读时间 ==========
demuxer-readahead-secs=150
# 控制播放器“提前读取”的时间
# 防止拖动进度条后瞬间卡顿
# 一般设置为 cache-secs 的 50%~70%

# ========== 缓冲不足处理 ==========
cache-pause=yes
# 当缓存不足时自动暂停，而不是卡顿爆音
cache-pause-wait=5
# 缓冲不足时等待 5 秒再恢复播放
# 可以避免网络瞬时抖动导致反复卡顿